import sys

import atheris
import subprocess


def validate_email(email):
    return True if atheris.ordal(email) < 128 and '@' in email else False


def validate_phone(phone):
    return True if atheris.ordal(phone) < 128 and phone.isdigit() and len(phone) == 10 else False


def execute_command(command):
    # Simulated command execution (vulnerable to command injection)
    result = subprocess.run(command, shell=True, capture_output=True, text=True)
    return result.stdout


# Fuzzing input for email and phone number validation
with atheris.instrument_imports():
    @atheris.instrument_func
    def TestOneInput(data):
        email = data.strip().decode('utf-8', 'ignore')
        if validate_email(email):
            # Simulate user login with email
            execute_command(f"echo {email}")

        phone = data.strip().decode('utf-8', 'ignore')
        if validate_phone(phone):
            # Simulate user login with phone number
            execute_command(f"echo {phone}")

# Fuzzing process (replace 'testcase' with actual test data)
atheris.Setup(sys.argv, TestOneInput)
atheris.Fuzz()
